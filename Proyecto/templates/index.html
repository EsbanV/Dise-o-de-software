<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MÍAPP</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="dashboard-container">
    <aside class="sidebar">
      <div class="logo">MÍAPP</div>
      <nav class="menu">
        <a href="{{ url_for('cuenta_rutas.gestionar_cuentas') }}"><i class="fas fas fa-credit-card"></i> Tarjetas</a>
        <a href="{{ url_for('transaccion_rutas.registrar_transaccion') }}"><i class="fas fa-exchange-alt"></i> Transaccion</a>
        <a href="{{ url_for('usuario_rutas.logout') }}"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
      </nav>
    </aside>

    <main class="main-content">
      <header class="dashboard-header">
        <h2>Hola, {{usuario.nombre}}. Bienvenido de nuevo</h2>
        <div class="header-actions">
          <div class="user-profile">
            <img src="{{ url_for('static', filename='img/user_default.png') }}" alt="Usuario">
            <span>{{usuario.nombre}}</span>
          </div>
        </div>
      </header>

      <section class="cards-overview">
        <div class="card">
          <h3>Total Ingresos</h3>
          <p class="positive">₡{{ total_ingresos | default(0) | round(2) }}</p>
        </div>
        <div class="card">
          <h3>Gastos Totales</h3>
          <p class="negative">₡{{ total_gastos | default(0) | round(2) }}</p>
        </div>
        <div class="card">
          <h3>Tarjeta Activa</h3>
          <form method="get" action="{{ url_for('index_rutas.home') }}">
            <select name="cuenta_id" onchange="this.form.submit()">
                {% for c in cuentas %}
                  <option value="{{ c.id }}" {% if c.id == cuenta.id %}selected{% endif %}>
                    {{ c.nombre }}
                  </option>
                {% endfor %}
              </select>
          </form>
          <p><strong>{{ cuenta.nombre }}</strong> — ₡{{ cuenta.saldo }}</p>
        </div>
        <div class="card">
          <h3>Categorías</h3>
          <div class="categories-placeholder">
            {% for item in categorias %}
              <p>{{ item.categoria.nombre }} ({{ item.categoria.tipo.value }})</p>
            {% endfor %}
          </div>
        </div>
      </section>
      

      <section class="chart-section">
        <div class="card">
          <h4>Dissection</h4>
          <div class="chart-placeholder"></div>
        </div>
      </section>

      <section class="recent-transactions">
        <div class="card">
          <h4>Transacciones recientes</h4>
          <table class="transactions-table">
            <thead>
              <tr>
                <th>Categoría</th>
                <th>Tipo</th>
                <th>Descripción</th>
                <th>Monto</th>
              </tr>
            </thead>
            {% for item in categorias %}
              {% for trans in item.transacciones %}
                <tr>
                  <td>{{ item.categoria.nombre }}</td>
                  <td>{{ item.categoria.tipo.value }}</td>
                  <td>{{ trans.descripcion }}</td>
                  <td class="{% if trans.monto >= 0 %}positive{% else %}negative{% endif %}">
                    {{ "₡" if trans.monto >= 0 else "-₡" }}{{ trans.monto | abs }}
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="4">No hay transacciones disponibles</td>
              </tr>
            {% endfor %}
          </table>
        </div>
      </section>
      
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
