<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Financiero</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">💰 MiApp</div>
      <nav class="menu">
        <a href="#">Gestion</a>
        <a href="{{ url_for('cuenta_rutas.crear_cuenta_bancaria') }}">Cuentas</a>
        <a href="#">Foro</a>
        <a href="#">Configuracion</a>
        <a href="{{ url_for('usuario_rutas.logout') }}">Cerrar Sesión</a>
      </nav>
    </aside>

    <!-- Contenido principal -->
    <main class="main-content">
      <header class="dashboard-header">
        <h2>
          Hola, {{ usuario.nombre }}. Bienvenido de nuevo!
        </h2>
        <!-- Select para elegir la cuenta de banco -->
        <div class="header-select">
          <label for="cuenta_select">Selecciona una cuenta:</label>
          <select id="cuenta_select" onchange="seleccionarCuenta('{{ url_for('index_rutas.home') }}');">
            <option value="">-- Selecciona una cuenta --</option>
            {% for cuenta in cuentas_bancarias %}
              <option value="{{ cuenta.id }}"
                {% if selected_cuenta_id and cuenta.id == selected_cuenta_id %} selected {% endif %}>
                {{ cuenta.nombre }} (Saldo: ${{ cuenta.saldo }})
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="header-actions">
          <input type="search" placeholder="Buscar..." />
          <div class="user-profile">
            <img src="{{ url_for('static', filename='img/user_default.png') }}" alt="Usuario" />
            <span>{{ usuario.nombre }}</span>
          </div>
        </div>
      </header>

      <!-- Sección resumen de la cuenta seleccionada -->
      {% if selected_cuenta_id and active_account %}
      <section class="account-summary">
        <h3>Resumen de la cuenta: {{ active_account.nombre }}</h3>
      </section>
      {% endif %}

      <!-- Tarjetas generales (pueden mostrar datos globales o de la cuenta seleccionada) -->
      <section class="cards-overview">
        <div class="card">
          <h3>Total Ingresos</h3>
          <p>${{ total_ingresos if total_ingresos is defined else '0' }}</p>
        </div>
        <div class="card">
          <h3>Gastos Totales</h3>
          <p>${{ total_gastos if total_gastos is defined else '0' }}</p>
        </div>
        <div class="card">
          <h3>Tarjeta Activa</h3>
          <p>{{ active_account.nombre if active_account is defined else 'Sin seleccionar' }}</p>
          <p>Saldo: ${{ active_account.saldo if active_account is defined else '0' }}</p>
        </div>
        <div class="card">
          <h3>Categorías</h3>
          <!-- Gráfico de torta con porcentajes de gasto en cada categoría -->
          <canvas id="chart-categorias"></canvas>
        </div>
      </section>

      <!-- Sección de gráficos -->
      <section class="charts-section">
        <div class="chart-box">
          <h4>Movimiento</h4>
          <canvas id="chart-dissection"></canvas>
        </div>
        <div class="chart-box">
          <h4>Ingresos vs Gastos</h4>
          <canvas id="chart-ingresos-gastos"></canvas>
        </div>
      </section>

      <!-- Listado de transacciones recientes -->
      <section class="transactions-list">
        <div class="chart-box">
          <h4>Transacciones recientes</h4>
          <ul class="transaction-items">
            {% for t in transacciones %}
              <li>
                <span>{{ t.fecha.strftime("%Y-%m-%d") }}</span>
                <span>{{ t.descripcion if t.descripcion is defined else "Transacción" }}</span>
                <span class="{{ 'positivo' if t.monto > 0 else 'negativo' }}">$ {{ t.monto }}</span>
              </li>
            {% else %}
              <li>No hay transacciones registradas.</li>
            {% endfor %}
          </ul>
        </div>
      </section>
    </main>
  </div>

  <!-- Carga del archivo JavaScript -->
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
