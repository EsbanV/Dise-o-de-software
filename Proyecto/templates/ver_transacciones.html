<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <title>Transacciones – Mi App Financiera</title>
</head>
<body>
  <header>
    <div class="perfil">
      <img src="{{ url_for('static', filename='img/user.jpg') }}" alt="Perfil">
      <p>Usuario: {{ session['user'] }}</p>
    </div>
    <h1>Transacciones</h1>
    <nav class="inicio">
      <ul>
        <li><a href="{{ url_for('index') }}">Inicio</a></li>
        <li><a href="{{ url_for('usuario_bp.logout') }}">Cerrar Sesión</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <form id="form-transacciones">
      <label for="categoria_id">ID de Categoría:</label>
      <input type="number" id="categoria_id" name="categoria_id" required>
      <button type="submit">Cargar</button>
    </form>

    <div id="loading" style="display:none;" aria-live="polite">Cargando...</div>

    <ul id="lista-transacciones"></ul>
  </main>

  <footer>
    <p>&copy; 2024 Mi App Financiera. Todos los derechos reservados.</p>
  </footer>

  <script>
    document.getElementById('form-transacciones').addEventListener('submit', e => {
      e.preventDefault();
      const catId = document.getElementById('categoria_id').value;

      if (!catId || isNaN(catId) || catId <= 0) {
        alert('Por favor, ingrese un ID de categoría válido.');
        return;
      }

      document.getElementById('loading').style.display = 'block';

      fetch(`/transacciones/${catId}`)
        .then(res => res.json())
        .then(data => {
          const ul = document.getElementById('lista-transacciones');
          ul.innerHTML = '';

          if (data.length === 0) {
            ul.innerHTML = '<li>No se encontraron transacciones para esta categoría.</li>';
          } else {
            data.forEach(t => {
              const li = document.createElement('li');
              li.textContent = `${new Date(t.fecha).toLocaleString()}: $${t.monto.toFixed(2)}`;
              ul.appendChild(li);
            });
          }
        })
        .catch(error => {
          alert('Error al cargar las transacciones. Intenta de nuevo.');
        })
        .finally(() => {
          document.getElementById('loading').style.display = 'none';
        });
    });
  </script>
</body>
</html>